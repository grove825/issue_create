name: Create Dynamic Branch on New Issue
on:
  issues:
    types: [assigned]
jobs:
  create-branch:
    name: "Create Dynamic Branch"
    runs-on: ubuntu-latest
    steps:
      - name: Set Branch Name
        id: set-branch-name
        run: |
          # Generate a dynamic branch name based on the current date and time
          branch_name=$(echo "issue-${{ github.event.issue.number }} ${{ github.event.issue.title }}" | tr '[:upper:]' '[:lower:]' | tr ' ' '_')
          echo "branch_name=$branch_name" >> $GITHUB_OUTPUT
      - name: Checkout Repository
        uses: actions/checkout@v4
      - name: Create Branch
        if: ${{ github.event.action == 'assigned' }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Retrieve the branch name from the previous step's output
          branch_name=${{ steps.set-branch-name.outputs.branch_name }}
          git switch development
          git checkout -b $branch_name
          git push --set-upstream origin $branch_name
      - name: Add Comment to Issue
        if: ${{ github.event.action == 'assigned' }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          issue_number=${{ github.event.issue.number }}
          branch_name=${{ steps.set-branch-name.outputs.branch_name }}
          repo_url=https://api.github.com/repos/${{ github.repository }}
          branch_url=https://github.com/${{ github.repository }}/tree/$branch_name
          curl -X POST -H "Authorization: Bearer $GITHUB_TOKEN" \
               -H "Accept: application/vnd.github.v3+json" \
               $repo_url/issues/$issue_number/comments \
               -d '{"body": "Branch created: ['$branch_name']('$branch_url')"}'